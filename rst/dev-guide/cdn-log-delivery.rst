================
CDN log delivery
================

.. 07/16/2014 New section suggested by David Goetz. Similar to "Access log delivery" but only for CDN. I am waiting examples for this section from Brian Metzler. Catherine, Actually- there's even a bigger change with the CDN logs- we added the referrer to the logs in the CDN recently. So we should should get some examples of that to show in this new section. Sorry we didn't tell you about this earlier- David

If you set the ``X-Log-Retention`` header on your CDN-enabled container
to ``True``, you enable CDN log delivery on that container. Then all the
request logs generated by the edge nodes of the CDN provider to objects
in this container are delivered into a special container created in your
account named ``.CDN_ACCESS_LOGS``. The delivered logs are in the same
format as access logs (see :ref:`Access log delivery<cf-dg-access-log-delivery>`). These logs, once delivered, are
treated like any other object in your account, and you are charged for
that storage.

You can use the CDN logs to analyze the number of requests for each
object, the client IP address, and time-based usage patterns (such as
monthly or seasonal usage).

.. note::

   Delivery times vary greatly for CDN logs. In most cases, the logs are
   delivered within several hours, but delivery can sometimes take days.
   Cloud Files can only deliver the logs to you as fast as the logs are
   delivered from the CDN provider.

When you set the ``X-Log-Retention`` header to ``True`` on a CDN-enabled
container, Cloud Files tracks every object in the container. If you have
multiple containers that you want to track, you must set the
``X-Log-Retention`` header to ``TRUE`` for each container. When your
first log is delivered, Cloud Files creates the ``.CDN_ACCESS_LOGS``
container. This container holds the CDN logs for every container for
which you turn on logging. Log files exist until you delete them. To
turn off logging, set the ``X-Log-Retention`` header to ``FALSE``.

Log files are named according to the following pattern: container name,
log date, log hour, and MD5 hash. For example::

    Media/2014/07/01/16/096e6c4473f235db081deb51f42a8d98.log.gz

In this example, ``Media`` is the name of the container, ``2014/07/01``
is the date (July 1, 2014), and ``16`` is the hour that the log file was
created. There might be multiple files for a given hour because the
storage system splits log files based on both time and log file size.
All times in the logs are UTC time. All logs contained in the log file
are from the day and hour specified in the file name.

Within the gzip logs, the format of the entries is similar to National
Center for Supercomputing Applications (NCSA) combined log format, but
without cookies. The pattern follows. The dashes (*``-``*) denote fields
that the NCSA combined log format dictates be present but that Cloud
Files does not capture.

``client_ip - - [day/month/year:hour:minute:second timezone] “method request           HTTP_version” return_code bytes_sent “referrer” “user_agent”``

The following example shows log entries.

**Example: CDN log entries**

.. code::

    173.203.44.122 - - [15/07/2014:20:52:25 +0000] "GET 
          /5142b6e5e57f760d7ff4-c591437fc634f2a98934b7738b8b8571.r93.cf1.rackcdn.
          com/image1.png HTTP/1.1" 304 277 "-" "Mozilla/4.0 (compatible; 
          MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.
          50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0;
          InfoPath.3; .NET4.0C; .NET4.0E; MS-RTC LM 8; Microsoft Outlook 14.0.
          7109; ms-office; MSOffice 14)"
    173.203.44.122 - - [15/07/2014:20:52:25 +0000] "GET 
          /5142b6e5e57f760d7ff4-c591437fc634f2a98934b7738b8b8571.r93.cf1.rackcdn.
          com/ email.png HTTP/1.1" 304 278 "-" "Mozilla/4.0 (compatible; 
          MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.
          50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; 
          InfoPath.3; .NET4.0C; .NET4.0E; MS-RTC LM 8; Microsoft Outlook 14.0.
          7109; ms-office; MSOffice 14)"
    173.203.44.122 - - [15/07/2014:20:52:25 +0000] "GET 
          /5142b6e5e57f760d7ff4-c591437fc634f2a98934b7738b8b8571.r93.cf1.rackcdn.
          com/ tiny-email.png HTTP/1.1" 304 277 "-" "Mozilla/4.0 (compatible; 
          MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.
          50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; 
          InfoPath.3; .NET4.0C; .NET4.0E; MS-RTC LM 8; Microsoft Outlook 14.0.
          7109; ms-office; MSOffice 14)"
    173.203.44.122 - - [15/07/2014:20:59:44 +0000] "GET 
          /5142b6e5e57f760d7ff4-c591437fc634f2a98934b7738b8b8571.r93.cf1.rackcdn.
          com/ default.css?ver=3.8.3 HTTP/1.1" 200 17511 "http://www.rackspace.
          com/" "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, 
          like Gecko) Chrome/35.0.1916.153 Safari/537.36"
    173.203.44.122 - - [15/07/2014:20:59:44 +0000] "GET 
          /5142b6e5e57f760d7ff4-c591437fc634f2a98934b7738b8b8571.r93.cf1.rackcdn.
          com/ jquery.min.js?ver=3.8.3 HTTP/1.1" 200 8022 "http://www.rackspace.
          com/" "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, 
          like Gecko) Chrome/35.0.1916.153 Safari/537.36"

